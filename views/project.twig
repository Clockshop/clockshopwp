{% extends "base.twig" %}

{% block content %}	

	<div class="project-single">

		<div class="project-menu">
			<div class="content">
				<h1>{{term.title}}</h1>

				<ul>
					{% for item in termMenu.items %}
						{% if item.current == true %}
							<li class="active">
						{% elseif ((post.project_content_type == 'artist_single') and (function('get_field', 'project_content_type', item.object_id) == 'artist_list')) %}
							<li class="active">
						{% elseif ((post.project_content_type == 'program_single') and (function('get_field', 'project_content_type', item.object_id) == 'program_list')) %}
							<li class="active">
						{% else %}
							<li>
						{% endif %}
							<a href="{{item.url}}">
								{{item.name}}
							</a>
						</li>
					{% endfor %}
				</ul>

				<form>

					<select>

						{% for item in termMenu.items %}
							<option value="{{item.url}}">
								{{item.name}}
							</option>
						{% endfor %}
						
					</select>

				</form>

			</div>
		</div>

		{% if post.get_field('project_content_type') == 'text' %}

			<main class="content">

				<div class="project-content">
					{{post.content}}
				</div>

			</main>

		{% elseif post.get_field('project_content_type') == 'artist_list' %}

			<main class="content artist-list">
				
				<div class="grid featured-grid project-list-grid">
				    {% for item in post.get_field('project_grid_content') %}
						<div class="grid-3">
							<div class="imagecell">
								<a href="{{item.grid_content.link}}"><img src="{{TimberImage(item.grid_content.thumbnail).src('grid-3')}}" /></a>
							</div>
							<a href="{{item.grid_content.link}}"><h3 class="project-title">{{item.grid_content.post_title}}</h3></a>
							<h3 class="project-subtitle">{{item.grid_content.project_artwork_and_artists_subtitle}}</h3>
						</div>
				    {% endfor %}
				</div>

			</main>

		{% elseif post.get_field('project_content_type') == 'artist_single' %}

			<main class="content artist-single">

			    {% if post.get_field('project_image_slider') %}
				    <div class="project-slider">
					    {% for item in post.get_field('project_image_slider') %}
							<div class="project-slide">
								<img src="{{TimberImage(item.url).src|resize(1900, 1267)}}" />
								{% if item.caption %}
									<div class="caption caption-left">
										{{item.caption}}
									</div>
								{% endif %}
								{% if item.description %}
									<div class="caption caption-right">
										{{item.description}}
									</div>
								{% endif %}
							</div>
					    {% endfor %}
				    </div>
			    {% endif %}

				<h3 class="project-title">{{post.title}}</h3>
				<p class="project-subtitle">{{post.project_subtitle}}</p>

				<div class="project-content">
					{{post.content}}
				</div>

				{% if post.get_field('related_content') %}

					<div class="grid project-related-grid featured-grid">

						<h4>Related Call Outs Projects or Events</h4>

						{% for item in post.get_field('related_content') %}

							<div class="grid-3">
								<div class="imagecell">
									<a href="{{item.item_url.url}}"><img src="{{TimberImage(item.item_image).src('grid-3')}}" /></a>
								</div>
								<div class="descriptioncell">
									<h2><a href="{{item.item_url.url}}">{{item.item_title}}</a></h2>
									<p class="content-type">{{item.item_type}}</p>
									<p class="description">{{item.item_description}}</p>
									<p class="calltoaction">
										<a href="{{item.item_url.url}}">{{item.item_call_to_action}}</a>
									</p>
								</div>
							</div>

						{% endfor %}

					</div>

				{% endif %}

			</main>

		{% elseif post.get_field('project_content_type') == 'program_list' %}

			<main class="content artist-list">
				
				<div class="grid featured-grid project-programs-grid">
				    {% for item in post.get_field('project_grid_content') %}
						<div class="grid-3">
							<div class="imagecell">
								<a href="{{item.grid_content.link}}"><img src="{{TimberImage(item.grid_content.thumbnail).src('grid-3')}}" /></a>
							</div>
							<a href="{{item.grid_content.link}}"><h3 class="project-title">{{item.grid_content.post_title}}</h3></a>
						</div>
				    {% endfor %}
				</div>

			</main>

		{% elseif post.get_field('project_content_type') == 'program_single' %}

			<main class="content">

				<div class="project-content">
					{{post.content}}
				</div>

				<div class="grid project-related-grid featured-grid">

					<h4>{{post.upcoming_programs_section_title}}</h4>

				    {% for item in post.get_field('upcoming_programs') %}

						<div class="grid-3">

							<div class="imagecell">
								<a href="{{function('get_permalink', item.event.id)}}"><img src="{{TimberImage(item.event).src('grid-3')}}" /></a>
							</div>
							<div class="descriptioncell">
								<h2><a href="{{function('get_permalink', item.event.id)}}">{{item.event.post_title}}</a></h2>
								<p class="content-type">{{function('spellerberg_sp_date', item.event)}}</p>
								<p class="add-descriptor">{{ function('get_term', event.event_venue).name }}</p>
								{% if item.event.post_excerpt %}
									<p class="description">{{item.event.post_excerpt}}</p>
								{% else %}
									<p class="description">{{item.event.get_preview(25, false, '', true, '')}}</p>
								{% endif %}
								<p class="calltoaction">
									<a href="{{function('get_permalink', item.event.id)}}">{{ item.event_list_cta_text|default('RSVP')}}</a>
								</p>
							</div>
						</div>

				    {% endfor %}

				</div>

			</main>

		{% elseif post.get_field('project_content_type') == 'collapsable_sections' %}
			
			<main class="content">

				<div class="collapsable-sections">
				    {% for item in post.get_field('collapsable_sections') %}
						<section>
						    <p class="section-title">{{item.section_title}}</p>
							<i class="fa fa-plus" aria-hidden="true"></i>
							<div class="section-content">
								{{item.section_content}}
							</div>
						</section>
				    {% endfor %}
				</div>

			</main>

		{% elseif post.get_field('project_content_type') == 'events' %}
			
			<main class="content">

				{% if events|length > 0 %}

					<div class="grid project-events-grid featured-grid">

						<h4>Related Events</h4>

						{% for event in events %}

							<div class="grid-3">

								<div class="imagecell">
									<a href="{{function('get_permalink', event)}}"><img src="{{TimberImage(event).src('grid-3')}}" /></a>
								</div>
								<div class="descriptioncell">								
									<h2><a href="{{function('get_permalink', event)}}">{{event.post_title}}</a></h2>
									<p class="content-type">{{ function('spellerberg_sp_date', event) }}</p>
									<p class="add-descriptor">{{ function('get_term', event.event_venue).name }}</p>
									{% if event.post_excerpt %}
										<p class="description">{{ event.post_excerpt }}</p>
									{% else %}
										<p class="description">{{ function('wp_trim_words', event.post_content, '20', '...') }}</p>
									{% endif %}
									<p class="calltoaction">
										<a href="{{event.url}}">{{ event.event_list_cta_text|default('RSVP')}}</a>
									</p>
								</div>
							</div>

						{% endfor %}

						<div class="grid-bottom"></div>

					</div>

				{% endif %}

				{% if pastEvents|length > 0 %}

					<section class="past-events">
						<h4>Past Events</h4>
						<div class="collapsable-sections collapsable-events">
							{% for event in pastEvents %}
								{% set lastYear = year|default('0') %}
								{% set year = event._EventStartDate|date('Y') %}
								
								{% if loop.index == 1 %}
									<section>
										<p class="section-title">{{ year }}</p>
										<i class="fa fa-plus" aria-hidden="true"></i>
										<div class="section-content">
								{% elseif year != lastYear %}
										</div>
									</section>
									<section>
										<p class="section-title">{{ year }}</p>
										<i class="fa fa-plus" aria-hidden="true"></i>
										<div class="section-content">
								{% endif %}

								{% set lastMonth = month|default('0') %}
								{% set month = event._EventStartDate|date('F') %}
								{% if lastMonth != month %}
											<p class="event-month"><span>{{ month }}</span></p>
								{% endif %}
					
											<div class="event-info">
												<p class="event-title">
													<a href="{{ event.link }}">
														{% if event.terms('projects') %}
															{{ event.terms('projects')[0].name ~ ': ' }}
														{% endif %}
														{{ event.title }}
													</a>
												</p>
												<p class="event-date"><span>{{ event._EventStartDate|date('F j, Y') }}</span></p>
											</div>

								{% if loop.last %}
										</div>
									</section>
								{% endif %}


							{% endfor %}
						</div>
					</section>

				{% endif %}

			</main>

		{% elseif post.get_field('project_content_type') == 'media' %}

			<main class="content media">

				{% if media_embeds %}

					<h4>Recordings</h4>

					{% for media in media_embeds %}

						<div class="media-item">
							
							<div class="media-content">
								<h2>{{media.0}}</h2>
								<p>{{media.1}}</p>
							</div>
							
							<div class="media-embed">
								
								{% if media.2%}
									<div class="media-video-embed" style="background: url('{{theme.link}}/images/loading.gif') center center no-repeat;">
										{{media.2}}
									</div>
								{% endif %}

								{% if media.3%}
									<div class="media-audio-embed" style="background: url('{{theme.link}}/images/loading.gif') center center no-repeat;">
										{{media.3}}
									</div>
								{% endif %}

							</div>
						</div>

					{% endfor %}

					{% if media_pagination %}

						<div class="media-pagination">
							{{media_pagination}}
						</div>

					{% endif %}

				{% endif %}

			</main>

		{% elseif post.get_field('project_content_type') == 'podcast' %}

			<main class="content podcast">

				<img class="podcast-image" src="{{TimberImage(post.podcast_cover_image)|resize(1900)}}" />

				<div class="podcast-text">
					{{post.podcast_intro_text}}
				</div>

				{% if podcast_episodes %}

					<h4>Podcast</h4>

					{% for podcast in podcast_episodes %}

						<div class="media-item podcast-item">
							
							<div class="media-content podcast-content">
								<p class="pod-ep">{{podcast.0}}</p>
								<h2 class="pod-title">{{podcast.1}}</h2>
								<p class="pod-date">{{podcast.2}}</p>
								<p class="pod-length">{{podcast.3}}</p>
								<p class="pod-description">{{podcast.4}}</p>
							</div>
							
							<div class="media-embed podcast-embed">
								<div class="media-audio-embed" style="background: url('{{theme.link}}/images/loading.gif') center center no-repeat;">
									{{podcast.5}}
								</div>
							</div>

						</div>

					{% endfor %}

					{% if podcast_pagination %}

						<div class="media-pagination">
							{{podcast_pagination}}
						</div>

					{% endif %}

				{% endif %}

			</main>

		{% endif %}

		{% for item in termMenu.items %}
			{% if check == true %}
				<div class="content project-next">
					<a href="{{item.link}}">
						Next: {{item.title}}
					</a>
				</div>
				{% set check = false %}
			{% endif %}
			{% if item.current %}
				{% set check = true %}
			{% endif %}
			{% if loop.last and item.current %}
				<div class="content project-next">
					<a href="{{termMenu.items.0.link}}">
						Next: {{termMenu.items.0.title}}
					</a>
				</div>
			{% endif %}
		{% endfor %}

		{% if post.project_content_type == 'artist_single' %}
			<div class="content project-next">
				<a href="{{post.parent.link}}">
					Back: {{post.parent.title}}
				</a>
			</div>
		{% endif %}

		{% if post.project_content_type == 'program_single' %}
			<div class="content project-next">
				<a href="{{post.parent.link}}">
					Back: {{post.parent.title}}
				</a>
			</div>
		{% endif %}

	</div>

{% endblock %}
